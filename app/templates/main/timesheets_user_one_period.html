{% extends 'base.html' %}


    {% block head %}

    <style type="text/css">
    .submitted-area{
        margin-top: 20px;
        margin-bottom: 20px;
    }

    #submit-ts-btn{
        /*margin-top: 30px;*/
    }

    .wf-items{
        margin: 25px;
    }

    </style>

    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">


    {% endblock %}

 

    {% block content %}

            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-12">
                    <h2>{{period|date:'F Y'}}</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="">Advocate Healthcare</a>
                        </li>
                        <li>
                            <a href="{% url 'timesheets' %}">Time Sheet Periods</a>
                        </li>
                        <li>
                            <a>Period</a>
                        </li> 
                    </ol>
                </div>
            </div>
        <div class="wrapper wrapper-content animated fadeInRight">

            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins"> 
                        <div class="ibox-content">
                           <div class="row">
                                <div class="col-lg-5">
                                    <h1>{{tsperiod.timelog_category.physician}}</h1>
                                    <h2>{{tsperiod.timelog_category.category}} - {{tsperiod.period|date:'F Y'}}</h2>
                                    <br>
                                    <h3>Status:</h3>
                                        {% if tsperiod.is_approved %}
                                        <div>This submission was approved on {{tsperiod.approved_at}}</div>
                                        {% endif %}

                                        {% if tsperiod.is_pending %}
                                        <div>This submission is currently pending and is held by {{tsperiod.current_user}}</div>
                                        {% endif %}

                                        {% if tsperiod.is_denied %}
                                        <div>This submission was denied by {{denial.user.get_full_name}} at {{denial.created_at}}</div>
                                        <div>Denial Note:</div>
                                        <div>
                                            {% if denial.note %}
                                                {{denial.note}}
                                            {% else %}
                                                None
                                            {% endif %}
                                        </div>
                                        {% endif %}
                                    
                                    <br>
                                    <h3>Total Times:</h3>
                                    {% for ts in timesheet_agg %}
                                    <div>{{ts.timelog_category__category__name}}: {{ts.time_sum}} mins from {{ts.sheet_count}} timesheets</div>
                                    {% endfor %}
                                    <br>
                                    <h3>Submitted:</h3>
                                    <div class='submitted-area'>

                                            {% if tsperiod.approved_at %}
                                            <span class='label label-primary' style='margin-right:3px' data-toggle="tooltip" data-placement="bottom" title="Approved on {{tsperiod.approved_at|date}}">{{tsperiod.timelog_category__category}}</span>
                                            {% else %}
                                            <span class='label' style='margin-right:3px' data-toggle="tooltip" data-placement="bottom" title="Submitted on {{tsperiod.created_at|date}}">{{tsperiod.category}}</span>
                                            {% endif %}

                                    </div>
                                </div>
                                <!-- end col 5-->
                                <div class='col-lg-7'>
                                    <div class='pull-right wf-items'>
                                        {% for wfi in workflowitems %}
                                        <span {% if forloop.counter0 == tsperiod.approval_num %} class='wf-item-current label'{% endif %}>{{wfi.user}}</span>
                                        <span> &gt </span>
                                        {% endfor %}
                                        <span> done </span>
                                    </div>
                                </div>
                            </div>
                            <!-- end row -->

                        <form method='post'>
                            {% csrf_token %}
                                    <div class="table-responsive">
                                <table class="table table-bordered table-hover table-conden" >
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Minutes Submitted</th>
                                        <th>Start Time</th>
                                        <th>End Time</th>
                                        <th>Created At</th>
                                        <th>Active</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for t in timesheets %}
                                    <tr>
                                        <td>{{t.date|date:'F jS (l)'}}</td>
                                        <td>{{t.mins_worked}}</td>
                                        <td>{{t.start_time}}</td>
                                        <td>{{t.end_time}}</td>
                                        <td>{{t.created_at}}</td>
                                        <td>{{t.active}}</td>
                                        <td>
                                            <a href="{% url 'timesheets_view_one' t.id %}" class='btn btn-xs btn-primary'>View</a>
                                            {% if not tsperiod %}
                                            <a href="{% url 'timesheets_physician_edit' t.id %}" class='btn btn-xs'>Edit</a>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>

                                </table>
                                    </div>
 

                            <label for="id_note">*Note:</label>
                            <textarea class="form-control" cols="20" id="id_note" name="note" rows="5" style='width:50%'></textarea>

                            <input type='hidden' name='submittimesheet'>

                            <div class='submitted-area'>
                                {% if tsperiod.current_user == request.user %}
                                <button class='btn btn-primary' id='submit-ts-btn'>Approve</button>
                                <button class='btn btn-danger'>Deny</button>
                                {% else %}
                                <button class='btn btn-primary' type='button' disabled="disabled">Approve</button>
                                <button class='btn btn-danger' type='button' disabled="disabled">Deny</button>
                                {% endif %}
                            </div>
                        </form>

                        </div>
                    </div>
                </div>

            </div>


        </div>


    {% endblock %}

    {% block scripts %}
    <!-- Page-Level Scripts -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>


    <script>

    $('.label').tooltip();




    $('#submit-ts-btn').click(function (e) {
        e.preventDefault();
        var form = $(this).parents('form');

        swal({
            title: "Are you sure?",
            text: "By clicking this button, you are stating that all times that you have submitted are correct.",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes, submit it!",
            closeOnConfirm: false
        }, function(isConfirm){
            if (isConfirm) form.submit();
        });
    });


    </script>
    {% endblock %}
